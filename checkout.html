<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f7f7f7;
      margin: 0;
    }

    .wrap {
      max-width: 420px;
      margin: auto;
      padding: 16px;
    }

    .card {
      background: #fff;
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    }

    h1 {
      font-size: 20px;
      margin-bottom: 4px;
    }

    .sub {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    .summary {
      display: flex;
      justify-content: space-between;
      background: #f3f4f6;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 16px;
      font-size: 15px;
    }

    input {
      width: 100%;
      padding: 14px;
      margin-bottom: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    .btn {
      width: 100%;
      padding: 16px;
      background: #000;
      color: #fff;
      font-size: 16px;
      border: none;
      border-radius: 14px;
      cursor: pointer;
    }

    .trust {
      text-align: center;
      font-size: 12px;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<div class="wrap">
  <div class="card">

    <h1>Checkout</h1>
    <p class="sub">Complete your order securely</p>

    <div class="summary">
      <span id="product">Product</span>
      <strong>â‚¹<span id="price">0</span></strong>
    </div>

    <!-- REQUIRED INFO -->
    <input id="name" placeholder="Full Name">
    <input id="phone" placeholder="Mobile Number">
    <input id="address" placeholder="House / Street / Area">
    <input id="city" placeholder="City">
    <input id="state" placeholder="State">
    <input id="pincode" placeholder="Pincode">

    <button class="btn" id="payBtn">
      Pay â‚¹<span id="btnPrice"></span> Securely
    </button>

    <p class="trust">
      ðŸ”’ Secure UPI payment â€¢ Confirmation on WhatsApp
    </p>

  </div>
</div>

<!-- EMAILJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("mlvIRvITsuSCGHJMH");
</script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAcokjcwR2WEiis__c61TuXEzYXhxUlKB8",
  authDomain: "shop-template-7d574.firebaseapp.com",
  projectId: "shop-template-7d574"
});
const db = firebase.firestore();
</script>

<script>
/* PRODUCT DATA */
const params = new URLSearchParams(location.search);
const product = params.get("product") || "Product";
const price = params.get("price") || "0";

document.getElementById("product").innerText = product;
document.getElementById("price").innerText = price;
document.getElementById("btnPrice").innerText = price;

const orderId = "ORD" + Date.now();

document.getElementById("payBtn").onclick = async () => {

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const state = document.getElementById("state").value.trim();
  const pincode = document.getElementById("pincode").value.trim();

  if (!name || !phone || !address || !city || !state || !pincode) {
    alert("Please fill all details");
    return;
  }

  // ðŸ”” ADMIN NOTIFICATION (ON CLICK)
  emailjs.send("service_d4k3sjg", "template_aqune66", {
    order_id: orderId,
    product,
    amount: price
  });

  // ðŸ’¾ SAVE ORDER
  await db.collection("orders").add({
    orderId,
    product,
    amount: Number(price),
    name,
    phone,
    address,
    city,
    state,
    pincode,
    status: "PENDING",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  // âœ… REDIRECT
  location.href = `success.html?orderId=${orderId}`;
};
</script>

</body>
</html>
