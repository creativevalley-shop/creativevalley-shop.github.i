<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Secure Checkout</title>

<style>
body {
  margin: 0;
  background: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  color: #111827;
}
header {
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
  padding: 12px;
  text-align: center;
  font-size: 13px;
}
.wrap {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 22px;
  box-shadow: 0 10px 30px rgba(0,0,0,.06);
}
h1 { font-size: 22px; }
.order { font-size: 13px; color: #6b7280; }
.summary {
  background: #f9fafb;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 18px;
}
.price { font-size: 18px; font-weight: 700; }
input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  margin-bottom: 10px;
}
button {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  border: none;
  background: #000;
  color: #fff;
  font-weight: 600;
}
.status { font-size: 13px; text-align: center; margin-top: 8px; }
</style>
</head>

<body>

<header>ðŸ”’ Secure Checkout â€¢ Prepaid Only</header>

<div class="wrap">
<div class="card">

<h1>Checkout</h1>
<p class="order">Order ID: <b id="orderId"></b></p>

<div class="summary">
  <h3 id="productName"></h3>
  <div class="price">â‚¹<span id="priceText"></span></div>
</div>

<input id="name" placeholder="Full Name *">
<input id="phone" placeholder="Mobile Number *">
<input id="email" placeholder="Email (optional)">
<input id="address" placeholder="House / Street *">
<input id="city" placeholder="City *">
<input id="state" placeholder="State *">
<input id="pincode" placeholder="Pincode *">

<button id="payBtn">Pay â‚¹<span id="payAmount"></span></button>
<p class="status" id="status"></p>

</div>
</div>

<!-- EMAILJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("mlvIRvITsuSCGHJMH");
</script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyAcokjcwR2WEiis__c61TuXEzYXhxUlKB8",
  authDomain: "shop-template-7d574.firebaseapp.com",
  projectId: "shop-template-7d574"
});
const db = firebase.firestore();
</script>

<script>
/* GET DATA */
const params = new URLSearchParams(location.search);
const productName = params.get("product") || "Product";
const amount = params.get("price") || "0";

/* ORDER ID */
const orderId = "ORD" + Date.now().toString().slice(-8);

/* DISPLAY */
document.getElementById("productName").innerText = productName;
document.getElementById("priceText").innerText = amount;
document.getElementById("payAmount").innerText = amount;
document.getElementById("orderId").innerText = orderId;

/* ELEMENTS */
const btn = document.getElementById("payBtn");
const statusEl = document.getElementById("status");

btn.onclick = async () => {

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const email = document.getElementById("email").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const state = document.getElementById("state").value.trim();
  const pincode = document.getElementById("pincode").value.trim();

  if (!name || !phone || !address || !city || !state || !pincode) {
    alert("Fill all required fields");
    return;
  }

  btn.disabled = true;
  statusEl.innerText = "Opening payment appâ€¦";

  await db.collection("orders").add({
    orderId,
    product: productName,
    amount: Number(amount),
    customerName: name,
    phone,
    email: email || null,
    address,
    city,
    state,
    pincode,
    status: "PENDING",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  emailjs.send("service_d4k3sjg","template_aqune66",{
    order_id: orderId,
    product: productName,
    amount,
    phone
  }).catch(()=>{});

  window.location.href =
    `upi://pay?pa=7381749483@okbizaxis&pn=MoneySprint&am=${amount}&cu=INR&tn=${orderId}`;

  setTimeout(()=>{
    window.location.href = `success.html?orderId=${orderId}`;
  },2000);
};
</script>

</body>
</html>
