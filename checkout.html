<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout – Earmuffs</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<header>
  <h1>Checkout</h1>
</header>

<main>
  <div class="product">
    <h2 id="product"></h2>
    <p class="price">₹<span id="price"></span></p>

    <p><b>Order ID:</b> <span id="orderId"></span></p>

    <p class="note">
      Please proceed to payment.  
      Ensure the <b>Order ID</b> is visible in the UPI payment note.
    </p>

    <button id="payBtn">Continue to Payment</button>
    <p id="status"></p>
  </div>
</main>

<!-- EMAILJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  emailjs.init("mlvIRvITsuSCGHJMH"); // Public Key
</script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  firebase.initializeApp({
    apiKey: "AIzaSyAcokjcwR2WEiis__c61TuXEzYXhxUlKB8",
    authDomain: "shop-template-7d574.firebaseapp.com",
    projectId: "shop-template-7d574"
  });

  const db = firebase.firestore();
</script>

<script>
  const params = new URLSearchParams(window.location.search);
  const product = params.get("product") || "Earmuffs";
  const price = params.get("price") || "499";
  const orderId = "ORD-" + Date.now();

  document.getElementById("product").innerText = product;
  document.getElementById("price").innerText = price;
  document.getElementById("orderId").innerText = orderId;

  const payBtn = document.getElementById("payBtn");
  const statusEl = document.getElementById("status");

  payBtn.onclick = async () => {
    payBtn.disabled = true;
    statusEl.innerText = "Creating your order…";

    try {
      await db.collection("orders").add({
        orderId,
        product,
        amount: Number(price),
        status: "PENDING",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      emailjs.send("service_d4k3sjg", "template_aqune66", {
        order_id: orderId,
        product: product,
        amount: price
      });

      window.location.href =
        `success.html?orderId=${orderId}&amount=${price}`;

    } catch (e) {
      statusEl.innerText = "❌ Unable to create order. Please try again.";
      payBtn.disabled = false;
    }
  };
</script>

</body>
</html>
