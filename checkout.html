<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Secure Checkout</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }

    body {
      margin: 0;
      background: #f4f6f8;
      color: #222;
    }

    header {
      background: #111;
      color: #fff;
      text-align: center;
      padding: 12px;
      font-size: 14px;
    }

    main {
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .checkout-card {
      background: #fff;
      max-width: 420px;
      width: 100%;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
    }

    h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }

    .order-id {
      font-size: 13px;
      color: #666;
      margin-bottom: 16px;
    }

    .summary {
      background: #f9fafb;
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 18px;
    }

    .summary h3 {
      margin: 0 0 6px;
      font-size: 16px;
    }

    .price {
      font-size: 20px;
      font-weight: 700;
      color: #16a34a;
    }

    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    input:focus {
      outline: none;
      border-color: #111;
    }

    .note {
      font-size: 12px;
      color: #555;
      margin: 10px 0;
      background: #fff7ed;
      padding: 10px;
      border-radius: 8px;
    }

    button {
      width: 100%;
      padding: 14px;
      background: #111;
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    footer {
      text-align: center;
      font-size: 13px;
      padding: 15px;
      color: #666;
    }
  </style>
</head>

<body>

<header>
  üîí Secure Checkout ‚Ä¢ Prepaid Orders Only
</header>

<main>
  <div class="checkout-card">

    <h1>Checkout</h1>
    <div class="order-id">
      Order ID: <b><span id="orderId"></span></b>
    </div>

    <div class="summary">
      <h3 id="productName"></h3>
      <div class="price">‚Çπ<span id="price"></span></div>
    </div>

    <!-- CUSTOMER -->
    <input id="name" type="text" placeholder="Full Name *">
    <input id="phone" type="tel" placeholder="Mobile Number *">
    <input id="email" type="email" placeholder="Email (optional)">

    <!-- ADDRESS -->
    <input id="address" type="text" placeholder="House / Street / Area *">
    <input id="city" type="text" placeholder="City *">
    <input id="state" type="text" placeholder="State *">
    <input id="pincode" type="number" placeholder="Pincode *">

    <div class="note">
      ‚ö†Ô∏è This is a <b>prepaid order</b>. Your order will be confirmed after payment verification.
    </div>

    <button id="continueBtn">
      Continue to Payment
    </button>

    <div id="status" class="status"></div>

  </div>
</main>

<footer>
  Need help? Contact us via WhatsApp
</footer>

<!-- ================= EMAILJS ================= -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function () {
  emailjs.init("mlvIRvITsuSCGHJMH");
})();
</script>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAcokjcwR2WEiis__c61TuXEzYXhxUlKB8",
  authDomain: "shop-template-7d574.firebaseapp.com",
  projectId: "shop-template-7d574"
});
const db = firebase.firestore();
</script>

<!-- ================= LOGIC (UNCHANGED) ================= -->
<script>
const params = new URLSearchParams(window.location.search);
const product = params.get("product") || "Product";
const price = params.get("price") || "0";

const orderId = "GC" + Date.now().toString().slice(-10);

document.getElementById("productName").innerText = product;
document.getElementById("price").innerText = price;
document.getElementById("orderId").innerText = orderId;

const btn = document.getElementById("continueBtn");
const statusEl = document.getElementById("status");

btn.addEventListener("click", async () => {
  const nameVal = name.value.trim();
  const phoneVal = phone.value.trim();
  const emailVal = email.value.trim();
  const addressVal = address.value.trim();
  const cityVal = city.value.trim();
  const stateVal = state.value.trim();
  const pincodeVal = pincode.value.trim();

  if (!nameVal || !phoneVal || !addressVal || !cityVal || !stateVal || !pincodeVal) {
    alert("Please fill all required fields");
    return;
  }

  btn.disabled = true;
  statusEl.innerText = "Processing‚Ä¶";

  emailjs.send("service_d4k3sjg","template_aqune66",{
    order_id: orderId,
    product: product,
    amount: price
  }).catch(()=>{});

  try {
    await db.collection("orders").add({
      orderId,
      product,
      amount: Number(price),
      customerName: nameVal,
      phone: phoneVal,
      email: emailVal || null,
      address: addressVal,
      city: cityVal,
      state: stateVal,
      pincode: pincodeVal,
      status: "PENDING",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    window.location.href = `success.html?orderId=${orderId}&amount=${price}`;

  } catch (err) {
    statusEl.innerText = "‚ùå Something went wrong. Please try again.";
    btn.disabled = false;
  }
});
</script>

</body>
</html>
