<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Secure Checkout</title>

<style>
body {
  margin: 0;
  background: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  color: #111827;
}
header {
  background: #ffffff;
  border-bottom: 1px solid #e5e7eb;
  padding: 12px;
  text-align: center;
  font-size: 13px;
}
.wrap {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #ffffff;
  border-radius: 16px;
  padding: 22px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.06);
}
h1 { font-size: 22px; }
.order { font-size: 13px; color: #6b7280; }
.summary {
  background: #f9fafb;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 18px;
}
.price { font-size: 18px; font-weight: 700; }
input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  margin-bottom: 10px;
}
button {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  border: none;
  background: #000;
  color: #fff;
  font-weight: 600;
  font-size: 16px;
}
button:disabled { opacity: 0.6; }
.status {
  text-align: center;
  font-size: 14px;
  margin-top: 12px;
}
.loader {
  margin: 12px auto;
  border: 4px solid #e5e7eb;
  border-top: 4px solid #000;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  100% { transform: rotate(360deg); }
}
</style>
</head>

<body>

<header>ðŸ”’ Secure Checkout â€¢ Prepaid Orders Only</header>

<div class="wrap">
<div class="card">

<h1>Checkout</h1>
<p class="order">Order ID: <b id="orderId"></b></p>

<div class="summary">
  <h3 id="productName"></h3>
  <div class="price">â‚¹<span id="priceText"></span></div>
</div>

<input id="name" placeholder="Full Name *">
<input id="phone" placeholder="Mobile Number *">
<input id="email" placeholder="Email (optional)">
<input id="address" placeholder="House / Street *">
<input id="city" placeholder="City *">
<input id="state" placeholder="State *">
<input id="pincode" placeholder="Pincode *">

<button id="payBtn">Pay â‚¹<span id="payAmount"></span></button>

<div id="status" class="status"></div>
<div id="loader" style="display:none" class="loader"></div>

</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const params = new URLSearchParams(location.search);
const productName = params.get("product") || "Product";
const amount = params.get("price") || "0";
const orderId = "ORD" + Date.now().toString().slice(-8);

/* DISPLAY */
document.getElementById("productName").innerText = productName;
document.getElementById("priceText").innerText = amount;
document.getElementById("payAmount").innerText = amount;
document.getElementById("orderId").innerText = orderId;

const btn = document.getElementById("payBtn");
const statusEl = document.getElementById("status");
const loader = document.getElementById("loader");

/* TELEGRAM */
function sendTelegramNotification(msg) {
  fetch(
    `https://api.telegram.org/bot8519147037:AAGXDo9ku4iOP6X6F2jQxnME08WwctUjoj0/sendMessage?chat_id=5820261983&text=${encodeURIComponent(msg)}`
  ).catch(()=>{});
}

/* UPI LINK */
function upiLink(orderId, amount) {
  return `upi://pay?pa=7381749483@okbizaxis&pn=StorePayment&am=${amount}&cu=INR&tn=${orderId}`;
}

btn.onclick = async () => {

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const state = document.getElementById("state").value.trim();
  const pincode = document.getElementById("pincode").value.trim();

  if (!name || !phone || !address || !city || !state || !pincode) {
    alert("Please fill all required fields");
    return;
  }

  btn.disabled = true;
  statusEl.innerText = "Processing paymentâ€¦ Please wait";
  loader.style.display = "block";

  /* SAVE ORDER */
  await db.collection("orders").add({
    orderId,
    product: productName,
    amount: Number(amount),
    customerName: name,
    phone,
    address,
    city,
    state,
    pincode,
    status: "PENDING",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  /* TELEGRAM NOTIFY (INSTANT) */
  sendTelegramNotification(
`ðŸ›’ NEW ORDER
ðŸ†” ${orderId}
ðŸ“¦ ${productName}
ðŸ’° â‚¹${amount}
ðŸ“ž ${phone}`
  );

  /* ðŸ”¥ OPEN UPI APP IMMEDIATELY */
  window.location.href = upiLink(orderId, amount);

  /* â³ KEEP PROCESSING FOR 15 SECONDS */
  setTimeout(() => {
    window.location.href = `success.html?orderId=${orderId}`;
  }, 15000);
};
</script>


</body>
</html>
